<!-- live documents are date, not version numbered. How changes are recognised and presented needs rewriting -->
<div class="govuk-grid-row">
    <div class="govuk-grid-column-full app-changelog">
      <p class="govuk-body">
    {% for log in changelog %}
      {%- if log.dataset_change and (log.dataset_change.added or log.dataset_change.removed) %}
          {%- if log.dataset_change.added|length %}

      {% for dataset in log.dataset_change.added %}

      <li><code>added the {{ dataset }}</code> dataset</li>

      {% endfor %}
      {% endif %}
      
      {% if log.dataset_change.removed|length %}
      <p class="govuk-body">We have removed the {% for dataset in log.dataset_change.removed %}
        {{dataset}}{{ ", " if not loop.last }}
      {% endfor %} dataset{{ "" if log.dataset_change.removed|length == 1 else "s" }}.</p>
      {% endif -%}
      {% endif -%}

      {%- if log.changes %}
      {% for c in log.changes %}
        {%- for field in c.added %}
        <li><code>{{ field }}</code> field added to the <code>{{c.dataset.dataset}}</code> dataset</li>
        {% endfor -%}
        {%- for field in c.removed %}
        <li><code>{{ field }}</code> field removed from the <code>{{c.dataset.dataset}}</code> dataset</li>
        {% endfor -%}
      {% endfor %}
      {%- endif -%}
    {% endfor %}
      </ul>
      <p>
    </div>
</div>
